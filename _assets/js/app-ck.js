function makeCounter(){var e=0,t=localStorage.getItem("count");e=t;return function(){e++;console.log(e);localStorage.setItem("count",JSON.stringify(e));return e}}function newList(e){e.preventDefault&&e.preventDefault();console.log(toDoLists);var t=prompt("What is your new list's name?");if(t!==null&&t!==""){var n=t.replace(/ /g,"_").toLowerCase();toDoLists.push({title:t,id:n,state:"open",todos:[]});toDoLists.length<2&&window.location.reload(!0)}localStorage.setItem("toDoLists",JSON.stringify(toDoLists));initElement()}function removeList(e){e.preventDefault&&e.preventDefault();var t=this.id;console.log(t);var n=confirm("Are you sure?");if(n)for(var r=0;r<toDoLists.length;r++)"delete_list "+toDoLists[r].id===t&&toDoLists.splice(r,1);localStorage.setItem("toDoLists",JSON.stringify(toDoLists));initElement()}function newItem(e){e.preventDefault&&e.preventDefault();var t=this.id,n=prompt("What is your to-do?");for(var r=0;r<toDoLists.length;r++)if("add_item "+toDoLists[r].id===t&&n!==null&&n!==""){var i={};i.todo=n;i.todoId=id();i.todoStatus="active";toDoLists[r].todos.push(i);console.log("Created todo "+i.todo+" with ID "+i.todoId)}localStorage.setItem("toDoLists",JSON.stringify(toDoLists));initElement()}function replaceItem(e){e.preventDefault&&e.preventDefault();var t=this.id,n=this.parentNode.parentNode.parentNode.id,r=prompt("Change this to-do.");for(var i=0;i<toDoLists.length;i++)if("todo_list "+toDoLists[i].id===n){var s=toDoLists[i];for(var e=0;e<s.todos.length;e++){var o=s.todos[e];console.log(o.todoId);if("edit_item "+o.todoId===t&&r!==null&&r!==""){o.todo=r;console.log("Updated todo ID "+o.todoId+" to "+o.todo)}}}localStorage.setItem("toDoLists",JSON.stringify(toDoLists));initElement()}function removeItem(e){e.preventDefault&&e.preventDefault();var t=this.id,n=this.parentNode.parentNode.parentNode.id;for(var r=0;r<toDoLists.length;r++)if("todo_list "+toDoLists[r].id===n){var i=toDoLists[r];for(var e=0;e<i.todos.length;e++){var s=i.todos[e];if("delete_item "+s.todoId===t){i.todos.splice(e,1);console.log("Deleted todo "+s.todo)}}}localStorage.setItem("toDoLists",JSON.stringify(toDoLists));initElement()}function completeItem(e){e.preventDefault&&e.preventDefault();var t=this.id,n=this.parentNode.parentNode.id;for(var r=0;r<toDoLists.length;r++)if("todo_list "+toDoLists[r].id===n){var i=toDoLists[r];for(var e=0;e<i.todos.length;e++){var s=i.todos[e];if("complete_item "+s.todoId===t)if(s.todoStatus==="active"){s.todoStatus="completed";console.log("Completed "+s.todo)}else{s.todoStatus="active";console.log("Brought "+s.todo+" out of retirement.")}}}localStorage.setItem("toDoLists",JSON.stringify(toDoLists));initElement()}function taskToggle(e){e.preventDefault&&e.preventDefault();var t=this.parentNode.nextSibling.nextSibling;console.log(t);t.style.display==="inline"?$(t).slideUp({duration:300,easing:"easeInBack"}):$(t).slideDown({duration:300,easing:"easeOutBack"})}function listToggle(e){e.preventDefault&&e.preventDefault();var t=this.nextSibling.nextSibling,n=t.id;console.log(t);for(var r=0;r<toDoLists.length;r++){var i=toDoLists[r];"todo_list "+i.id===n&&(i.state==="open"?i.state="closed":i.state="open")}localStorage.setItem("toDoLists",JSON.stringify(toDoLists));initElement()}function initElement(){var e=localStorage.getItem("toDoLists");e&&(toDoLists=JSON.parse(e));$(function(){var e=$("#todo-template").html(),t=Mustache.to_html(e,{lists:toDoLists});$("#lists").html(t);$("#lists").masonry("reloadItems")});var t=document.getElementById("addList");t.onclick=newList;var n=document.getElementsByClassName("delete_list");for(var r=0;r<n.length;r++)n[r].onclick=removeList;var i=document.getElementsByClassName("add_item");for(var r=0;r<i.length;r++)i[r].onclick=newItem;var s=document.getElementsByClassName("edit_item");for(var r=0;r<s.length;r++)s[r].onclick=replaceItem;var o=document.getElementsByClassName("delete_item");for(var r=0;r<o.length;r++)o[r].onclick=removeItem;var u=document.getElementsByClassName("toggle_status");for(var r=0;r<u.length;r++)u[r].onclick=completeItem;var a=document.getElementsByClassName("task_toggle");for(var r=0;r<a.length;r++)a[r].onclick=taskToggle;var f=document.getElementsByClassName("list_title");for(var r=0;r<f.length;r++)f[r].onclick=listToggle;$(function(){$("#lists").masonry({itemSelector:".list_wrap",isResizeBound:!0,transitionDuration:0})})}var id=makeCounter(),toDoLists=[{title:"Books to Read",id:"books_to_read",state:"open",todos:[{todoId:id(),todoStatus:"completed",todo:"A Game of Thrones"},{todoId:id(),todoStatus:"active",todo:"A Clash of Kings"},{todoId:id(),todoStatus:"active",todo:"A Storm of Swords"},{todoId:id(),todoStatus:"completed",todo:"A Feast for Crows"}]}];