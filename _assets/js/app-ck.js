function makeCounter(){var e=0,t=localStorage.getItem("count");e=t;return function(){e++;console.log(e);localStorage.setItem("count",JSON.stringify(e));return e}}function titleList(){listTitles.length=0;for(var e=0;e<archive.length;e++){var t=archive[e].list,n=archive[e].listId;console.log(t);listTitles.push({name:t,"class":n})}}function newList(e){e.preventDefault&&e.preventDefault();console.log(toDoLists);var t=prompt("What is your new list's name?");if(t!==null&&t!==""){var n=t.replace(/ /g,"_").toLowerCase();toDoLists.push({title:t,id:n,state:"open",todos:[]});toDoLists.length<2&&window.location.reload(!0)}localStorage.setItem("toDoLists",JSON.stringify(toDoLists));initElement()}function removeList(e){e.preventDefault&&e.preventDefault();var t=this.id;console.log(t);var n=confirm("Are you sure?");if(n)for(var r=0;r<toDoLists.length;r++)"delete_list "+toDoLists[r].id===t&&toDoLists.splice(r,1);localStorage.setItem("toDoLists",JSON.stringify(toDoLists));initElement()}function newItem(e){e.preventDefault&&e.preventDefault();var t=this.id,n=prompt("What is your to-do?");for(var r=0;r<toDoLists.length;r++)if("add_item "+toDoLists[r].id===t&&n!==null&&n!==""){var i={};i.todo=n;i.todoId=id();i.todoStatus="active";toDoLists[r].todos.push(i);console.log("Created todo "+i.todo+" with ID "+i.todoId)}localStorage.setItem("toDoLists",JSON.stringify(toDoLists));initElement()}function replaceItem(e){e.preventDefault&&e.preventDefault();var t=this.id,n=this.parentNode.parentNode.parentNode.id,r=prompt("Change this to-do.");for(var i=0;i<toDoLists.length;i++)if("todo_list "+toDoLists[i].id===n){var s=toDoLists[i];for(var e=0;e<s.todos.length;e++){var o=s.todos[e];console.log(o.todoId);if("edit_item "+o.todoId===t&&r!==null&&r!==""){o.todo=r;console.log("Updated todo ID "+o.todoId+" to "+o.todo)}}}localStorage.setItem("toDoLists",JSON.stringify(toDoLists));initElement()}function removeItem(e){e.preventDefault&&e.preventDefault();var t=this.id,n=this.parentNode.parentNode.parentNode.id;for(var r=0;r<toDoLists.length;r++)if("todo_list "+toDoLists[r].id===n){var i=toDoLists[r];for(var e=0;e<i.todos.length;e++){var s=i.todos[e];if("delete_item "+s.todoId===t){i.todos.splice(e,1);console.log("Deleted todo "+s.todo)}}}localStorage.setItem("toDoLists",JSON.stringify(toDoLists));initElement()}function completeItem(e){e.preventDefault&&e.preventDefault();var t=this.id,n=this.parentNode.parentNode.id;for(var r=0;r<toDoLists.length;r++)if("todo_list "+toDoLists[r].id===n){var i=toDoLists[r];for(var e=0;e<i.todos.length;e++){var s=i.todos[e];if("complete_item "+s.todoId===t)if(s.todoStatus==="active"){s.todoStatus="completed";console.log("Completed "+s.todo)}else{s.todoStatus="active";console.log("Brought "+s.todo+" out of retirement.")}}}localStorage.setItem("toDoLists",JSON.stringify(toDoLists));initElement()}function toArchive(e){e.preventDefault&&e.preventDefault();var t=this.id,n=this.parentNode.parentNode.parentNode.id;console.log(t);for(var r=0;r<toDoLists.length;r++)if("todo_list "+toDoLists[r].id===n){var i=toDoLists[r];for(var e=0;e<i.todos.length;e++){var s=i.todos[e];if("archive_item "+s.todoId===t){var o={};o.todo=s.todo;o.todoId=s.todoId;o.list=i.title;o.listId=i.id;archive.push(o);titleList();listTitles=unique(listTitles);console.log(listTitles);i.todos.splice(e,1);console.log("Archived todo "+s.todo)}}}localStorage.setItem("toDoLists",JSON.stringify(toDoLists));localStorage.setItem("archive",JSON.stringify(archive));localStorage.setItem("listTitles",JSON.stringify(listTitles));initElement()}function unArchive(e){e.preventDefault&&e.preventDefault();var t=this.id;for(var e=0;e<archive.length;e++){var n=archive[e];if("promote_item "+n.todoId===t)for(var r=0;r<toDoLists.length;r++){var i=toDoLists[r];if(i.id===n.listId){var s={};s.todo=n.todo;s.todoId=n.todoId;s.todoStatus="active";i.todos.push(s);archive.splice(e,1);console.log("Unarchived todo "+n.todo);titleList();listTitles=unique(listTitles)}}}localStorage.setItem("toDoLists",JSON.stringify(toDoLists));localStorage.setItem("archive",JSON.stringify(archive));localStorage.setItem("listTitles",JSON.stringify(listTitles));initElement()}function archiveFilter(e){e.preventDefault&&e.preventDefault();var t=this.id;if(t==="all")$(".list_wrap").show();else{$(".list_wrap").hide();$("."+t).show()}}function taskToggle(e){e.preventDefault&&e.preventDefault();var t=this.parentNode.nextSibling.nextSibling;console.log(t);t.style.display==="inline"?$(t).slideUp({duration:300,easing:"easeInBack"}):$(t).slideDown({duration:300,easing:"easeOutBack"})}function listToggle(e){e.preventDefault&&e.preventDefault();var t=this.nextSibling.nextSibling,n=t.id;console.log(t);for(var r=0;r<toDoLists.length;r++){var i=toDoLists[r];"todo_list "+i.id===n&&(i.state==="open"?i.state="closed":i.state="open")}localStorage.setItem("toDoLists",JSON.stringify(toDoLists));initElement()}function initElement(){var e=localStorage.getItem("toDoLists"),t=localStorage.getItem("archive"),n=localStorage.getItem("listTitles");e&&(toDoLists=JSON.parse(e));t&&(archive=JSON.parse(t));n&&(listTitles=JSON.parse(n));$(function(){var e=$("#todo-template").html(),t=Mustache.to_html(e,{lists:toDoLists});$("#lists").html(t);$("#lists").masonry("reloadItems")});$(function(){var e=$("#archive-template").html(),t=Mustache.to_html(e,{lists:archive,titles:listTitles});$("#archived").html(t);$("#archived").masonry("reloadItems")});var r=document.getElementById("addList");r.onclick=newList;var i=document.getElementsByClassName("delete_list");for(var s=0;s<i.length;s++)i[s].onclick=removeList;var o=document.getElementsByClassName("add_item");for(var s=0;s<o.length;s++)o[s].onclick=newItem;var u=document.getElementsByClassName("edit_item");for(var s=0;s<u.length;s++)u[s].onclick=replaceItem;var a=document.getElementsByClassName("delete_item");for(var s=0;s<a.length;s++)a[s].onclick=removeItem;var f=document.getElementsByClassName("archive_item");for(var s=0;s<f.length;s++)f[s].onclick=toArchive;var l=document.getElementsByClassName("promote_item");for(var s=0;s<l.length;s++)l[s].onclick=unArchive;var c=document.getElementsByClassName("filter");for(var s=0;s<c.length;s++)c[s].onclick=archiveFilter;var h=document.getElementsByClassName("toggle_status");for(var s=0;s<h.length;s++)h[s].onclick=completeItem;var p=document.getElementsByClassName("task_toggle");for(var s=0;s<p.length;s++)p[s].onclick=taskToggle;var d=document.getElementsByClassName("list_title");for(var s=0;s<d.length;s++)d[s].onclick=listToggle;$(function(){$("#lists").masonry({itemSelector:".list_wrap",isResizeBound:!0,transitionDuration:0})})}var id=makeCounter(),toDoLists=[{title:"Books to Read",id:"books_to_read",state:"open",todos:[{todoId:id(),todoStatus:"completed",todo:"A Game of Thrones"},{todoId:id(),todoStatus:"active",todo:"A Clash of Kings"},{todoId:id(),todoStatus:"active",todo:"A Storm of Swords"},{todoId:id(),todoStatus:"completed",todo:"A Feast for Crows"}]}],archive=[],listTitles=[],unique=function(e){var t=[],n=e.length,r,i,s;for(i=0;i<n;i++){r=undefined;for(s=0;s<t.length;s++)if(e[i].name===t[s].name){r=!0;break}r||t.push(e[i])}return t};